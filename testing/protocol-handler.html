<!DOCTYPE html>
<html>
	<head>
		<title>Testing Protocol Handlers</title>
	</head>
	<body>
		<h1>Evan-Brass.Github.io</h1>
		<script>
			const add_handler = document.createElement('button');
			add_handler.innerText = 'Add Protocol Handler';
			document.body.appendChild(add_handler);
			add_handler.onclick = () => {
				let endpoint = new URL(window.location);
				endpoint.searchParams.append('uri', '');
				endpoint = endpoint.toString() + '=%s';
				navigator.registerProtocolHandler(
					"web+burger",
					endpoint,
					"Testing protocol handlers."
				);
			};

			const url = new URL(window.location);
			if (window.location.searchParams.has('uri')) {
				const channel = new MessageChannel();
				window.parent.postMessage({
					message_port: channel.port2
				}, '*', [channel.port2]);
				channel.port1.onmessage = ({ data, origin, source }) => {
					console.log(origin, data);
					source.postMessage({ ack: data });
				};
			}
		</script>
	</body>
</html>